drop table knup_print;
drop table knup_user;
drop table knup_file;
drop table knup_printer;
drop SEQUENCE seq_file;
drop SEQUENCE seq_print;

create table knup_user(
    userId INT primary key,
    userEmail varchar2(20),
    userName varchar2(20)
);


CREATE TABLE knup_file(
    fileNo INT primary key NOT NULL,
    fileName varchar2(1000) NOT NULL,
    fileCapacity varchar2(20) NOT NULL,
    fileFormat varchar2(20) NOT NULL,
    fileUploadDate varchar2(35) NOT NULL
    );
    
CREATE SEQUENCE seq_file START WITH 1 INCREMENT BY 1 MAXVALUE 1000 CYCLE NOCACHE;
    
 CREATE TABLE knup_printer(
    printerNo INT primary key not NULL,
    printerLoc varchar2(20) NOT NULL,
    prinerState varchar2(20) NOT NULL
    );
    
    
CREATE TABLE knup_print(
    printNo INT primary key NOT NULL,
    fileNo INT,
    printerNo INT,
    userId INT,
    printDate DATE NOT NULL,
    printStatus varchar2(20) NOT NULL,
    
    CONSTRAINT fk_code1 FOREIGN KEY(fileNo)
         REFERENCES knup_file(fileNo) ON DELETE CASCADE,
         
    CONSTRAINT fk_code2 FOREIGN KEY(printerNo)
         REFERENCES knup_printer(printerNo) ON DELETE CASCADE,
    
    CONSTRAINT fk_code3 FOREIGN KEY(userId)
         REFERENCES knup_user(userId) ON DELETE CASCADE
         
    );
         
CREATE SEQUENCE seq_print START WITH 1 INCREMENT BY 1 MAXVALUE 1000 CYCLE NOCACHE;

----0427 db----
//print table에 code를 추가하고, pritner table의 printerLoc를 printerName으로 변경하였습니다.

Alter table knup_print add(code varchar2(20));
Alter table knup_printer rename column printerLoc to printerName;

//printerNo를 drop하고 printerName을 print의 foreign key로 설정하였습니다.

alter table knup_print drop constraint fk_code2;
Alter table knup_print drop column printerNo;
Alter table knup_print add printerName varchar2(20);
alter table knup_print add UNIQUE(printerName);
alter table knup_printer add UNIQUE(printerName);
alter table knup_print add constraint fk_code2 FOREIGN KEY(printerName) REFERENCES knup_printer(printerName);

//설정한 제약조건을 확인합니다.
select a.constraint_name, a.table_name, b.column_name, a.constraint_type, a.r_constraint_name
from user_constraints a, user_cons_columns b
where
a.constraint_name=b.constraint_name;

//constraint_type
// - P : 기본키 (Primary Key)
//
// - R : 외래키 (Foreign Key)
//
// - U : 고유값 (Unique)
//
// - C : 체크 (Not Null, Check). search_condition 컬럼에서 내용 확인 가능합니다.

